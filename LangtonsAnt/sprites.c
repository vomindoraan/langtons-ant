#include "sprites.h"

#include <assert.h>

#define ANT_S_SZ       SPRITE_SZ_(SPRITE_ANT_SIZE_SMALL)
#define ANT_M_SZ       SPRITE_SZ_(SPRITE_ANT_SIZE_MEDIUM)
#define ANT_L_SZ       SPRITE_SZ_(SPRITE_ANT_SIZE_LARGE)
#define STEPUP_SZ      SPRITE_SZ_(SPRITE_STEPUP_SIZE)
#define ARROW_SZ       SPRITE_SZ(SPRITE_UDARROW_WIDTH,  SPRITE_UDARROW_HEIGHT)
#define BUTTON_SZ      SPRITE_SZ(SPRITE_BUTTON_WIDTH,   SPRITE_BUTTON_HEIGHT)
#define DIGIT_SZ       SPRITE_SZ(SPRITE_DIGIT_WIDTH,    SPRITE_DIGIT_HEIGHT)
#define INFINITY_SZ    SPRITE_SZ(SPRITE_INFINITY_WIDTH, SPRITE_INFINITY_HEIGHT)

#define SI_UDARROW(a)  SI(arrow_sprites[a],  SPRITE_UDARROW_WIDTH,  SPRITE_UDARROW_HEIGHT)
#define SI_RLARROW(a)  SI(arrow_sprites[a],  SPRITE_RLARROW_WIDTH,  SPRITE_RLARROW_HEIGHT)
#define SI_STEPUP()    SI(stepup_sprite,     SPRITE_STEPUP_SIZE,    SPRITE_STEPUP_SIZE)
#define SI_BUTTON(a)   SI(button_sprites[a], SPRITE_BUTTON_WIDTH,   SPRITE_BUTTON_HEIGHT)
#define SI_DIGIT(a)    SI(digit_sprites[a],  SPRITE_DIGIT_WIDTH,    SPRITE_DIGIT_HEIGHT)
#define SI_INFINITY()  SI(infinity_sprite,   SPRITE_INFINITY_WIDTH, SPRITE_INFINITY_HEIGHT)

static sprite_t ant_s_sprites[][ANT_S_SZ] = {
	[DIR_UP]    = { 0x48, 0x00 },
	[DIR_RIGHT] = { 0x0C, 0x00 },
	[DIR_DOWN]  = { 0x09, 0x00 },
	[DIR_LEFT]  = { 0x18, 0x00 }
};
static sprite_t ant_m_sprites[][ANT_M_SZ] = {
	[DIR_UP]    = { 0x24, 0x18, 0x5A, 0x3C, 0x18, 0x3C, 0x5A, 0x18 },
	[DIR_RIGHT] = { 0x00, 0x44, 0x29, 0xFE, 0xFE, 0x29, 0x44, 0x00 },
	[DIR_DOWN]  = { 0x18, 0x5A, 0x3C, 0x18, 0x3C, 0x5A, 0x18, 0x24 },
	[DIR_LEFT]  = { 0x00, 0x22, 0x94, 0x7F, 0x7F, 0x94, 0x22, 0x00 }
};
static sprite_t ant_l_sprites[][ANT_L_SZ] = {
	[DIR_UP] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x42, 0x00,
		0x00, 0x24, 0x00, 0x00, 0x18, 0x00, 0x01, 0x3C, 0x80, 0x01, 0x3C, 0x80,
		0x00, 0x99, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x7E, 0x00,
		0x03, 0xBD, 0xC0, 0x00, 0x7E, 0x00, 0x00, 0x99, 0x00, 0x01, 0x3C, 0x80,
		0x01, 0x7E, 0x80, 0x02, 0x7E, 0x40, 0x02, 0x7E, 0x40, 0x00, 0x7E, 0x00,
		0x00, 0x3C, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	[DIR_RIGHT] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x10, 0x00, 0x01, 0x90, 0xC0,
		0x00, 0x51, 0x04, 0x0F, 0x2A, 0x08, 0x1F, 0xBE, 0xD0, 0x3F, 0xFF, 0xE0,
		0x3F, 0xFF, 0xE0, 0x1F, 0xBE, 0xD0, 0x0F, 0x2A, 0x08, 0x00, 0x51, 0x04,
		0x01, 0x90, 0xC0, 0x06, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	[DIR_DOWN] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x3C, 0x00,
		0x00, 0x7E, 0x00, 0x02, 0x7E, 0x40, 0x02, 0x7E, 0x40, 0x01, 0x7E, 0x80,
		0x01, 0x3C, 0x80, 0x00, 0x99, 0x00, 0x00, 0x7E, 0x00, 0x03, 0xBD, 0xC0,
		0x00, 0x7E, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x99, 0x00,
		0x01, 0x3C, 0x80, 0x01, 0x3C, 0x80, 0x00, 0x18, 0x00, 0x00, 0x24, 0x00,
		0x00, 0x42, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	[DIR_LEFT] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x60, 0x03, 0x09, 0x80,
		0x20, 0x8A, 0x00, 0x10, 0x54, 0xF0, 0x0B, 0x7D, 0xF8, 0x07, 0xFF, 0xFC,
		0x07, 0xFF, 0xFC, 0x0B, 0x7D, 0xF8, 0x10, 0x54, 0xF0, 0x20, 0x8A, 0x00,
		0x03, 0x09, 0x80, 0x00, 0x08, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
};

SpriteInfo ant_sprite(unsigned size, Direction dir)
{
	unsigned s = SPRITE_ANT_SIZE_SMALL, m = SPRITE_ANT_SIZE_MEDIUM, l = SPRITE_ANT_SIZE_LARGE;
	return (size >= l) ? SI(ant_l_sprites[dir], l, l)
	     : (size >= m) ? SI(ant_m_sprites[dir], m, m)
	     : (size >= s) ? SI(ant_s_sprites[dir], s, s)
	     : SI_NONE;
}

const LogoSprites logo1_sprites = {
	.base = {
		0xC0, 0x01, 0x00, 0x40, 0x01, 0x00, 0x04, 0x01, 0x00,
		0x04, 0xD8, 0xD9, 0x31, 0x80, 0x15, 0x55, 0x4A, 0xA4,
		0x00, 0x55, 0x55, 0x2A, 0x88, 0x01, 0x35, 0x32, 0x4A,
		0x60, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x06, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00
	},
	.hl = {
		0x00, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00,
		0xC0, 0x00, 0x00, 0x00, 0x0B, 0x40, 0x00, 0x00, 0x00,
		0x1E, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00,
		0x01, 0xE0, 0x00, 0x00, 0x00, 0x0B, 0x40, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00
	},
};
const LogoSprites logo2_sprites = {
	.base = {
		0xE0, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x00,
		0x84, 0x00, 0x07, 0x03, 0x38, 0xD0, 0x00, 0x24, 0x12,
		0x92, 0x48, 0x00, 0x90, 0x4A, 0x47, 0xE0, 0x01, 0xC0,
		0xC9, 0x30, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x18,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00
	},
	.hl = {
		0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
		0x00, 0x1D, 0xC0, 0x70, 0x00, 0x00, 0x94, 0x81, 0x00,
		0x00, 0x02, 0x52, 0x04, 0x00, 0x00, 0x07, 0x48, 0x0C,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00
	},
};
static const LogoSprites *logo_sprites[] = {
	&logo1_sprites, &logo2_sprites,
};

SpriteInfo logo_sprite(unsigned index, bool highlight)
{
	if (index < LEN(logo_sprites)) {
		const LogoSprites *ls = logo_sprites[index];
		return SI_LOGO(highlight ? ls->hl : ls->base);
	}
	return SI_NONE;
}

static sprite_t arrow_sprites[][ARROW_SZ] = {
	[DIR_UP]    = { 0x5C },
	[DIR_RIGHT] = { 0xB8 },
	[DIR_DOWN]  = { 0xE8 },
	[DIR_LEFT]  = { 0x74 }
};
static sprite_t stepup_sprite[STEPUP_SZ] = {
	0x5D, 0x00  // > 0xCF, + 0x5D
};
static sprite_t button_sprites[_UIB_COUNT][BUTTON_SZ] = {
	[UIB_PLAY]    = { 0x43, 0x1C, 0xC4, 0x00 },
	[UIB_PAUSE]   = { 0x02, 0x94, 0xA0, 0x00 },
	[UIB_STOP]    = { 0x03, 0x9C, 0xE0, 0x00 },
	[UIB_CLEAR]   = { 0x47, 0x92, 0x17, 0x00 },
	[UIB_PENDING] = { 0x00, 0x2A, 0x00, 0x00 },
};
static sprite_t digit_sprites[][DIGIT_SZ] = {
	{ 0xF6, 0xDE }, { 0x24, 0x92 }, { 0xE7, 0xCE }, { 0xE7, 0x9E }, { 0xB7, 0x92 },
	{ 0xF3, 0x9E }, { 0xF3, 0xDE }, { 0xE4, 0x92 }, { 0xF7, 0xDE }, { 0xF7, 0x9E },
};
static sprite_t infinity_sprite[INFINITY_SZ] = {
	0x71, 0xD1, 0x46, 0x10, 0xC5, 0x17, 0x1C
};

SpriteInfo ui_sprite(UISpriteType type, int arg)
{
	switch (type) {
	case UI_ARROW:
		assert(arg >= DIR_UP && arg <= DIR_LEFT);
		return (arg == DIR_UP || arg == DIR_DOWN) ? SI_UDARROW(arg) : SI_RLARROW(arg);

	case UI_STEPUP:
		return SI_STEPUP();

	case UI_BUTTON:
		assert(arg >= 0 && arg < _UIB_COUNT);
		return SI_BUTTON(arg);

	case UI_DIGIT:
		assert(arg >= 0 && arg < 10);
		return SI_DIGIT(arg);

	case UI_INFINITY:
		return SI_INFINITY();

	default:
		return assert(0), SI_NONE;
	}
}